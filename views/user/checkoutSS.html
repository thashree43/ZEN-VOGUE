<%- include("../layouts/userpartials/header.ejs") %>

<style>
    
    .checkout_area {
    padding: 50px 0;
}

.order_box {
    padding: 20px;
    background-color: #f8f9fa;
    border-radius: 5px;
}

/* Additional styling for the Your Order Payment Details section */
.order-box {
    background-color: #f8f8f8;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
    width: 100%; /* Make the width 100% to fit the entire container */
}

.order-box h2 {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 20px; /* Adjust margin for better spacing */
    color: #000000;
}

.order-list {
    list-style-type: none;
    padding: 0;
}

.order-list li {
    margin-bottom: 10px;
}

.order-list a {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 18px;
    color: #333;
    text-decoration: none;
}

.order-list span {
    font-family: math;
    color: #000000;
}

.payment-methods {
    margin-top: 30px;
}

.payment-methods label {
    font-size: 18px;
    font-weight: bold;
    color: #333;
    margin-bottom: 10px;
    display: block;
}

.payment-option {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.payment-option input[type="radio"] {
    margin-right: 10px;
}

.payment-option label {
    font-size: 16px;
    color: #333;
    cursor: pointer;
}

.place-order-btn {
    background-color: #ff0000;
    color: #fff;
    border: none;
    border-radius: 5px;
    padding: 15px 30px;
    text-decoration: none;
    font-weight: bold;
    font-size: 18px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.place-order-btn:hover {
    background-color: #8d8a8a;
}

/* Additional styling for the wallet-section if needed */
.wallet-section {
    background-color: #f8f8f8;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 15px;
    margin-top: 20px;
}

.wallet-title {
    font-size: 18px;
    font-weight: bold;
    color: #333;
    margin-bottom: 10px;
    cursor: pointer;
}

.wallet-info {
    display: flex;
    align-items: center;
    font-size: 20px;
    font-weight: 500;
}

.wallet-label {
    margin-right: 10px;
}

.wallet-amount {
    color: #ff0000;
}

.coupon_box,
.wallet_box {
    margin-top: 20px;
    padding: 15px;
    background-color: #f8f9fa;
    border-radius: 5px;
}

.coupon_box h2,
.wallet_box h2 {
    font-size: 24px;
    margin-bottom: 10px;
}

.coupon_input {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 5px;
}

.coupon_button,
.wallet_button {
    margin-top: 10px;
    padding: 8px 15px;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
}

.billing_details {
    padding-top: 20px;
}

.billing_details h3 {
    font-size: 24px;
    margin-bottom: 15px;
}

.modal-header {
    background-color: #ff0000;
    color: white;
}

.coupon-code {
    padding: 10px 16px;
    margin-bottom: 15px;
    background-color: #f8f8f8;
    color: #000000;
    border: 1px solid #ddd;
    border-radius: 6px;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
}

.coupon-code:hover {
    transform: translateY(-3px);
    box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.2);
}

.coupons-list {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 20px;
}

.no-coupon {
    display: block;
    text-align: center;
    font-size: 18px;
    color: #ca0000;
}

.btn-close {
    color: #000000;
    opacity: 0.8;
    transition: opacity 0.3s ease;
}

.btn-close:hover {
    opacity: 1;
    color: rgb(255, 255, 255);
}

.modal-footer {
    border-top: 1px solid #dfd9d9;
    padding: 10px;
}

.modal-footer .btn-secondary {
    background-color: #ff0000;
    border-color: #000000;
    color: #fffafa;
    transition: background-color 0.3s ease;
}

.modal-footer .btn-secondary:hover {
    background-color: #8d8a8a;
}

.modal-footer .btn-primary {
    background-color: #007bff;
    border-color: #007bff;
    transition: background-color 0.3s ease;
}

.modal-footer .btn-primary:hover {
    background-color: #0056b3;
}

.btn {
    border-radius: 30px;
    background-color: #ff0000;
}

.coupons-list {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 20px;
}

.coupon {
    background-color: #f9f9f9;
    border: 1px solid #c5c3c3;
    border-radius: 5px;
    padding: 10px;
    width: 300px;
}

.coupon-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.coupon-code {
    font-size: 18px;
    font-weight: bold;
}

.coupon-type {
    font-size: 16px;
    padding: 5px 10px;
    border-radius: 5px;
}

.percentage-off {
    background-color: #1ac70a;
    color: white;
}

.fixed-off {
    background-color: #ff0000;
    color: white;
}

.coupon-details {
    margin-top: 10px;
    font-size: 14px;
    color: #000000;
}

.no-coupon {
    font-size: 16px;
    font-weight: bold;
    color: #f00;
}

body {
    font-family: Arial, sans-serif;
    background-color: #f8f9fa;
    margin: 0;
    padding: 0;
}

.checkout-main {
    padding: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.checkout-container {
    background-color: #ffffff;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    padding: 20px;
    border-radius: 5px;
    width: 100%;
    max-width: 95%;
    padding: 50px;
    margin-left: 30px;
}

.coupon-input-wrapper {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#code {
    flex: 1;
    padding: 10px;
    border: 1px solid #d60000;
    border-radius: 5px;
    margin-right: 10px;
}

#wallet {
    flex: 1;
    padding: 10px;
    border: 1px solid #d60000;
    border-radius: 5px;
    margin-right: 10px;
}

.apply-coupon-btn {
    background-color: #ff0000;
    color: #fff;
    border: none;
    border-radius: 45px;
    padding: 10px;
    cursor: pointer;
}

.wallet-btn {
    background-color: #ff0000;
    color: #fff;
    border: none;
    border-radius: 45px;
    padding: 10px 20px;
    cursor: pointer;
}

.apply-coupon-btn:hover {
    opacity: 1;
    background-color: rgb(54, 54, 54);
}

.wallet-btn:hover {
    opacity: 1;
    background-color: rgb(41, 41, 41);
}

.billing-title {
    font-size: 24px;
    font-weight: bold;
    margin-top: 50px;
    margin-bottom: 40px;
    color: #333;
}

.add-address-btn {
    background-color: #ff0000;
    color: #fff;
    border: none;
    border-radius: 45px;
    padding: 20px 30px;
    text-decoration: none;
    font-weight: bold;
    font-size: 16px;
}

.add-address-btn:hover {
    background-color: #8d8a8a;
}

.address-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.address-item {
    display: flex;
    align-items: center;
    border: 1px solid #ccc;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.address-item:hover {
    background-color: #f8f8f8;
}

.address-details {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
}

.address-name {
    font-weight: bold;
    font-size: 18px;
    margin-bottom: 10px;
}

.address-info {
    display: flex;
    flex-direction: column;
}

.address-field {
    margin-right: 50px;
    margin-bottom: 15px;
    font-size: 14px;
}

.address-field span {
    font-weight: bold;
    margin-right: 5px;
    color: #000000;
}

.address-item-input[type="radio"] {
    margin-right: 10px;
}

.edit-btn,
.delete-btn {
    background-color: #ff0000;
    color: #fff;
    border: none;
    border-radius: 45px;
    margin-bottom: 0;
    text-decoration: none;
    font-weight: bold;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.edit-btn:hover,
.delete-btn:hover {
    background-color: #8d8a8a;
}

.order-box {
    background-color: #f8f8f8;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
    margin-left: auto; /* Align to the right by adding auto margin to the left */
}

.order-box h2 {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 60px;
    color: #000000;
}

.order-title {
    font-size: 24px;
    font-weight: bold;
    color: #000000;
}

.order-list {
    list-style-type: none;
    padding: 0;
}

.order-list li {
    margin-bottom: 10px;
}

.order-list a {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 18px;
    color: #333;
    text-decoration: none;
}

.order-list span {
    font-family: math;
    color: #000000;
}

.payment-methods {
    margin-top: 30px;
}

.payment-methods label {
    font-size: 18px;
    font-weight: bold;
    color: #333;
    margin-bottom: 10px;
    display: block;
}

.payment-option {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.payment-option input[type="radio"] {
    margin-right: 10px;
}

.payment-option label {
    font-size: 16px;
    color: #333;
    cursor: pointer;
}

.place-order-btn {
    background-color: #ff0000;
    color: #fff;
    border: none;
    border-radius: 5px;
    padding: 15px 30px;
    text-decoration: none;
    font-weight: bold;
    font-size: 18px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.place-order-btn:hover {
    background-color: #8d8a8a;
}

.wallet-section {
    background-color: #f8f8f8;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 15px;
    margin-top: 20px;
}

.wallet-title {
    font-size: 18px;
    font-weight: bold;
    color: #333;
    margin-bottom: 10px;
    cursor: pointer;
}

.wallet-info {
    display: flex;
    align-items: center;
    font-size: 20px;
    font-weight: 500;
}

.wallet-label {
    margin-right: 10px;
}

.wallet-amount {
    color: #ff0000;
}

.billing-details,
.order-box {
    display: flex;
    justify-content: flex-start;
    align-items: flex-start;
    flex-wrap: wrap;
}

.billing-details,
.order-box,
.billing-details .col-lg-8,
.order-box .col-lg-4 {
    width: 100%;
}

.order-box h2,
.billing-title {
    margin-bottom:0px;
}

.billing-details .col-lg-8
{
    width: 100%;
    margin-bottom: 30px;
}

.order-box .col-lg-4 {
    width: 100%;
    margin-bottom: 30px;
}

.order-box {
    margin-left: auto; /* Align to the right by adding auto margin to the left */
}

.edit-btn,
.delete-btn {
    width: 100%;
    margin-top: 10px;
    padding: 10px;
    text-align: center;
    background-color: #ff0000; /* Red color for delete button */
    color: #fff;
    border: none;
    border-radius: 45px;
    text-decoration: none;
    font-weight: bold;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.edit-btn:hover,
.delete-btn:hover {
    background-color: #8d8a8a;
}

</style>
    <main>
        <!-- Hero Area Start-->
        <div class="slider-area ">
            <div class="single-slider slider-height2 d-flex align-items-center">
                <div class="container">
                    <div class="row">
                        <div class="col-xl-12">
                            <div class="hero-cap text-center">
                                <h2>Checkout</h2>
                                <p>Check your valuable product details here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> <!--================Checkout Area =================-->
        <section class="checkout_area section_padding">
            <div class="checkout-container">
                <div class="order_box col-lg-4">
                    <!-- Button trigger modal -->
                    <button type="button" class="btn py-4 mb-5 circle arrow" data-bs-toggle="modal"
                        data-bs-target="#exampleModal"> Available Coupons
                    </button>
                    <!-- Modal -->
                    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5 text-white" id="exampleModalLabel">Available Coupons
                                    </h1>
                                    <div type="button" class="btn-close" data-bs-dismiss="modal" aria-label="x-icon">
                                        <svg xmlns="http:www.w3.org/2000/svg" width="36" height="36" fill="currentColor"
                                            class="bi bi-x" viewBox="0 0 16 16">
                                            <path
                                                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="modal-body">
                                    <div class="coupons-list">

                                        <div class="coupon">
                                            <div class="coupon-header"> <span class="coupon-code">

                                                </span> <span class="coupon-type ">

                                                </span> </div>
                                            <div class="coupon-details">
                                                <p>Expires:
                                                </p>
                                                <p>Balance:</p>
                                            </div>
                                        </div>

                                        <span class="no-coupon">No Coupon Available!</span>

                                    </div>

                                </div>
                                <div class="modal-footer"> <button type="button" class="btn btn-secondary py-4"
                                        data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h2>Coupon</h2>

                    <form id="coupon-form">
                        <div class="cart-coupon">
                            <input type="text" id="code" name="cart-coupon" placeholder="Coupon code">
                            <button type="submit" class="apply-coupon-btn  success circle arrow">Apply Coupon</button>
                        </div>
                    </form>
                    <div class="wallet-section">
                        <h5 class="wallet-title" data-bs-toggle="collapse" data-bs-target="#faq-item-2-2"
                            aria-expanded="true">
                            Available Wallet Money
                        </h5>
                        <div class="wallet-info"> <span class="wallet-label">Wallet:</span>
                            <span id="walletbalance" class="wallet-amount">₹</span>
                        </div>
                    </div>




                    <label for="wallet"></label> <input type="text" name="wallet" id="wallet"
                        placeholder="Enter Wallet Amount" required> <button
                        class="wallet-btn btn_4 success circle arrow">Add</button>

                </div>

                <div class="billing-details">
                    <div class="row">
                        <div class="col-lg-8">
                            <h3 class="billing-title">Billing Address</h3>
                            <hr>
                            <br>

                            <a class="add-address-btn" href="/addAddresscheck">ADD ADDRESS</a>
                            <br>
                            <br><br>
                            <form id="checkout">
                                <% if (Array.isArray(address) && address.length> 0) { %>
                                    <div class="address-list">
                                        <% address.forEach((value, index)=> { %>
                                            <% if (value && typeof value==='object' ) { %>
                                                <div class="address-item">
                                                    <input name='address' class="form-check-input"  type="radio" value="<%= value._id %>" 
                                                       required>
                                                    <label class="form-check-label" for="flexCheckDefault<%= index %>">
                                                        <div class="address-details">
                                                            <div class="address-name">
                                                                <p>name:<%= value.fname %>
                                                                    <%= value.sname %>
                                                                </p>
                                                            </div>
                                                            <div class="address-info">
                                                                <div class="address-field">
                                                                   <p>Address:<%= value.address %></p>
                                                                </div>
                                                                <div class="address-field">
                                                                    <p>Phone :<%= value.mobile %></p>
                                                                       
                                                                </div>
                                                                <div class="address-field">
                                                                <p> Email: <%= value.email %></p>
                                                                </div>
                                                                <div class="address-field">
                                                                <p>  City:<%= value.city %></p>
                                                                </div>
                                                                <div class="address-field">
                                                                <p>Pin: <%= value.pin %></p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </label>
                                                </div>
                                                <br>
                                                <div style="display: flex;">
                                                    <div>
                                                        <a class="genric-btn edit-btn"
                                                            href="/editAddresscheck?id=<%= value._id %>&index=<%= index %>">Edit</a>
                                                    </div>
                                                    <div style="margin-left: 10px;">
                                                        <a class="genric-btn delete-btn"
                                                            href="/deleteAddressCheck?id=<%= value._id %>">Delete</a>
                                                    </div>
                                                </div>
                                    </div>
                                    <% } else { %>
                                        <p>Error: Invalid address data at index <%= index %>
                                        </p>
                                        <% } %>
                                            <% }); %>
                        </div>
                        <% } else { %>
                            <p>No addresses available.</p>
                            <% } %>

                    </div>
                    <div class="col-lg-4">
                        <div class="order-box">
                            <h2>Your Order Payment Details</h2>
                            <hr>
                            <ul class="order-list">
                                <li>
                                    <a>Subtotal
                                        <span id="total2">
                                           = <%= subtotal %>/-
                                        </span>
                                    </a>
                                </li>
                                <input type="hidden" value="<%= subtotal%>" name="subtotal">
                                <li>
                                    <a>Coupon Amount <span id="coupon"></span>
                                    </a>
                                </li>
                                <li>
                                    <a>Grand Total
                                        <span id="total1">
                                            <%= subtotal %>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                            <div class="payment-methods">
                                <label for="Payment">Select Payment Method:</label>
                                <div class="payment-option">
                                    <input type="radio" id="payment-cod" name="Payment" value="COD" required>
                                    <label for="Payement">Cash On Delivery</label>
                                </div>
                                <div class="payment-option">
                                    <input type="radio" id="payment-wallet" name="Payment" value="wallet" required>
                                    <label for="Payement">Wallet</label>
                                </div>
                                <div class="payment-option">
                                    <input type="radio" id="payment-online" name="Payment" value="online" required>
                                    <label for="Payement">Online Payment</label>
                                </div>
                            </div>
                            <button  type="submit">Place Order</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            </div>
        </section>
    </main>
   

<!-- Include Swal (SweetAlert) library -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<!-- Add this script at the end of your HTML body -->
<script>
const form = document.getElementById('checkout')
form.addEventListener('submit', async (event) => {
    event.preventDefault();
    try {
      

        // Serialize the form data
        const formData = $('#checkout').serialize();
        console.log(formData, "gghsghjwghs");

        $.ajax({
            type: "POST",   
            url: "/checkout",
            data: formData ,
            success: function (response) {
                if (response.success) {
                    const id = response.orderId
                    // Order placed successfully
                    Swal.fire({
                        icon: 'success',
                        title: 'Order Placed!',
                        text: 'Your order has been placed successfully.',
                    }).then(() => {
                      
                        window.location.href = `/ordersuccess?id=${id}`; 
                    });
                }
            },
            error: function (error) {
                console.log("AJAX Error:", error);
            }
        });
    } catch (error) {
        console.error(error.message);
        Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'An unexpected error occurred. Please try again.',
        });
    }
});


</script>



    <%- include("../layouts/userpartials/footer.ejs") %>